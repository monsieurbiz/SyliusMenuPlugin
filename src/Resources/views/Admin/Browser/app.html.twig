<script type="text/javascript">
    /**
     * Choose type of provider (Product, Taxon etc.)
     */
    function monsieurbizSyliusMenuBrowserList(inputName, inputValue, locale)
    {
        const params = new URLSearchParams({
            inputName: inputName,
            inputValue: inputValue,
            locale: locale,
        });
        monsieurbizSyliusMenuLoadModal("{{ path('monsieurbiz_menu_admin_browser_list')|escape('js') }}", params);
    }

    /**
     * Choose route for given prodiver (Select a product in a list, select a taxon in a list etc.)
     */
    function monsieurbizSyliusMenuBrowseListItems(inputName, inputValue, locale, providerCode, search)
    {
        const params = new URLSearchParams({
            inputName: inputName,
            inputValue: inputValue,
            locale: locale,
            providerCode: providerCode,
            search: search,
        });
        monsieurbizSyliusMenuLoadModal("{{ path('monsieurbiz_menu_admin_browser_list_items')|escape('js') }}", params);
    }

    function monsieurbizSyliusMenuLoadModal(route, params)
    {
        let req = new XMLHttpRequest();
        req.onload = function(progress) {
            if (this.status === 200) {
                monsieurbizSyliusMenuBrowserRemoveLoaderModal();
                const locale = params.get('locale');
                var myModal = bootstrap.Modal.getInstance(document.getElementById('modal-' + locale));
                if (myModal) {
                    myModal.dispose()
                }
                const modalWrapper = document.getElementById('modal-' + locale + '-wrapper');
                modalWrapper.innerHTML = this.responseText;
                var myModal = bootstrap.Modal.getOrCreateInstance(document.getElementById('modal-' + locale), {
                    keyboard: false
                });
                myModal.show();
                monsieurbizSyliusMenuBrowserSearchEnter();
            } else {
                monsieurbizSyliusMenuBrowserRemoveLoaderModal();
            }
        };
        req.open("get", route + "?" + params.toString(), true);
        req.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        req.send();
        monsieurbizSyliusMenuBrowserAddLoaderModal();
    }

    /**
     * Choose route for given prodiver (Select a product in a list, select a taxon in a list etc.)
     */
    function monsieurbizSyliusMenuBrowseChooseItem(inputName, inputValue, locale, providerCode, value)
    {
        monsieurbizSyliusMenuBrowserCloseModal(locale);
        document.querySelector('input[name="' + inputName + '"]').value = value;
    }

    function monsieurbizSyliusMenuBrowserCloseModal(locale)
    {
        var modal = bootstrap.Modal.getInstance(document.getElementById('modal-' + locale))
        modal.hide();
        modal.dispose();
    }

    function monsieurbizSyliusMenuBrowserAddLoaderModal()
    {
        document.querySelectorAll('.monsieurbiz-sylius-menu-browser__loader').forEach(function(modal) {
            modal.classList.add('active');
        });
    }

    function monsieurbizSyliusMenuBrowserRemoveLoaderModal()
    {
        document.querySelectorAll('.monsieurbiz-sylius-menu-browser__loader').forEach(function(modal) {
            modal.classList.remove('active');
        });
    }

    function monsieurbizSyliusMenuBrowserSearchEnter()
    {
        let input = document.querySelector(".monsieurbiz-sylius-menu-browser__search input");
        let button = document.querySelector(".monsieurbiz-sylius-menu-browser__search div.button");
        if (input && button) {
            input.addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                button.click();
            }
            });
        }
    }
</script>


<style>
    .monsieurbiz-sylius-menu-browser__modal > .content {
        height: 50vh;
        overflow-y: auto;
    }

    .monsieurbiz-sylius-menu-browser__item:not(.monsieurbiz-sylius-menu-browser__item-search) {
        height: 30px;
        cursor: pointer;
    }

    .monsieurbiz-sylius-menu-browser__item:hover:not(.monsieurbiz-sylius-menu-browser__item-search) {
        background-color: #cce2ff;
    }

    .monsieurbiz-sylius-menu-browser__modal .ui.list > .item > i.icon,
    .monsieurbiz-sylius-menu-browser__modal .ui.list > .item > .icon + .content
    {
        vertical-align: middle;
    }
</style>
